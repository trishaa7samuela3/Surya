<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KITA Travels Invoice</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* A4 Definition */
        :root {
            --a4-width: 210mm;
            --a4-height: 297mm;
        }

        body {
            background-color: #f3f4f6;
            -webkit-tap-highlight-color: transparent;
        }

        /* Print Specifics - Critical for PDF generation */
        @media print {
            @page { margin: 0; size: A4; }
            body { background: white; }
            .no-print { display: none !important; }
            .print-padding { padding: 0 !important; }
            .print-shadow-none { box-shadow: none !important; }
            /* Reset transformations for print */
            #invoice-wrapper {
                transform: none !important;
                width: 100% !important;
                height: auto !important;
                margin: 0 !important;
                padding: 0 !important;
                overflow: visible !important;
            }
            .page-container {
                width: 210mm !important;
                min-height: 297mm !important;
                margin: 0 !important;
                border: none !important;
                transform: none !important;
            }
        }

        /* Input Highlighting for ease of use */
        input:focus, textarea:focus {
            background-color: #eff6ff;
            outline: 2px solid #3b82f6;
            border-radius: 2px;
        }
        
        /* Smooth scaling transition */
        #invoice-wrapper {
            transition: transform 0.2s ease-out;
            transform-origin: top center;
        }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- Icons ---
    const ShareIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg>;
    const EditIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>;
    const CheckIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>;
    const UploadIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>;
    const CloseIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
    const PlusIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
    const TrashIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;

    // --- Component Moved Outside ---
    const InputField = ({ value, onChange, isEditing, type = "text", className = "", style = {}, placeholder="" }) => {
        if (!isEditing && !value) return null; // Don't render empty fields in view mode
        if (!isEditing) return <div className={`${className}`} style={style}>{value}</div>;
        return (
            <input
                type={type}
                value={value}
                onChange={(e) => onChange(e.target.value)}
                placeholder={placeholder}
                className={`border border-blue-400 rounded px-1 py-0.5 bg-blue-50 text-inherit w-full mb-0.5 ${className}`}
                style={{...style, minWidth: '20px'}}
            />
        );
    };

    const InvoiceGenerator = () => {
        const [isEditing, setIsEditing] = useState(false);
        const [scale, setScale] = useState(1);
        const fileInputRef = useRef(null);

        // Calculate scale to fit mobile screen
        useEffect(() => {
            const handleResize = () => {
                const a4WidthPx = 794; // approx 210mm @ 96dpi
                const screenWidth = window.innerWidth;
                const newScale = Math.min((screenWidth - 20) / a4WidthPx, 1);
                setScale(newScale);
            };

            window.addEventListener('resize', handleResize);
            handleResize(); // Init
            return () => window.removeEventListener('resize', handleResize);
        }, []);

        // --- Data State ---
        const [invoiceData, setInvoiceData] = useState({
            companyName: "KITA TRAVELS",
            companyAddress: [
                "19th Floor, Epitome Building No.5,",
                "DLF Cybercity, DLF Phase III,",
                "Gurgaon, Haryana, 122001",
                "Phno: 8248114737",
                "Email: kitatravelsbooking@gmail.com"
            ],
            logo: null, 
            bookingId: "NF7AG9LV82114804895",
            invoiceNo: "M06AI26I09116278",
            date: "18 Aug 2025",
            transType: "B2C/REG",
            
            pan: "AADCM5146R",
            hsn: "998551",
            gstin: "06AADCM5146R1ZZ",
            serviceDesc: "Reservation Services For Air Transportation",
            rcm: "No",
            
            customerName: "Indra Kumari",
            customerAddress: ["", "", ""], // 3 lines for customer address
            
            bookedBy: "Nirmal Surya",
            bookedByAddress: ["", "", ""], // 3 lines for booked by address

            // Dynamic Payment Items
            lineItems: [
                { id: 1, description: "Fare Charges", subtext: "(including applicable flight taxes collected on behalf of airline & other ancillary charges)", amount: 17715.00 },
                { id: 2, description: "Service Fees", subtext: "", amount: 222.03 },
                { id: 3, description: "Trip Assure Fee", subtext: "", amount: 422.03 },
                { id: 4, description: "CGST @9%", subtext: "", amount: 57.97 },
                { id: 5, description: "SGST @9%", subtext: "", amount: 57.97 }
            ],

            pageNo: "Page 1 of 1"
        });

        const handlePrint = () => {
            window.print();
        };

        const handleLogoUpload = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onloadend = () => setInvoiceData({ ...invoiceData, logo: reader.result });
                reader.readAsDataURL(file);
            }
        };

        const updateAddress = (index, value) => {
            const newAddress = [...invoiceData.companyAddress];
            newAddress[index] = value;
            setInvoiceData({ ...invoiceData, companyAddress: newAddress });
        };
        
        const updateCustomerAddress = (index, value) => {
            const newAddress = [...invoiceData.customerAddress];
            newAddress[index] = value;
            setInvoiceData({ ...invoiceData, customerAddress: newAddress });
        };

        const updateBookedByAddress = (index, value) => {
            const newAddress = [...invoiceData.bookedByAddress];
            newAddress[index] = value;
            setInvoiceData({ ...invoiceData, bookedByAddress: newAddress });
        };

        // Payment Table Functions
        const updateLineItem = (index, field, value) => {
            const newItems = [...invoiceData.lineItems];
            newItems[index] = { ...newItems[index], [field]: value };
            setInvoiceData({ ...invoiceData, lineItems: newItems });
        };

        const addLineItem = () => {
            const newItem = { 
                id: Date.now(), 
                description: "New Fee", 
                subtext: "", 
                amount: 0.00 
            };
            
            const items = [...invoiceData.lineItems];
            // Find index of first item containing 'GST' to insert before it
            let insertIndex = items.findIndex(item => 
                (item.description && item.description.toUpperCase().includes("GST"))
            );
            
            if (insertIndex === -1) {
                items.push(newItem);
            } else {
                items.splice(insertIndex, 0, newItem);
            }
            
            setInvoiceData({ ...invoiceData, lineItems: items });
        };

        const removeLineItem = (index) => {
            const newItems = invoiceData.lineItems.filter((_, i) => i !== index);
            setInvoiceData({ ...invoiceData, lineItems: newItems });
        };

        const calculateTotal = () => {
            return invoiceData.lineItems.reduce((acc, item) => acc + Number(item.amount), 0).toFixed(2);
        };

        return (
            <div className="min-h-screen pb-12 font-sans bg-gray-100 flex flex-col items-center">
                
                {/* --- Mobile Toolbar (Sticky Top) --- */}
                <div className="w-full bg-white shadow-md sticky top-0 z-50 px-4 py-3 flex justify-between items-center no-print">
                    <div className="flex flex-col">
                        <h1 className="text-lg font-bold text-gray-900 leading-none">KITA Invoice</h1>
                        <span className="text-xs text-gray-500 mt-1">Mobile Editor</span>
                    </div>
                    <div className="flex gap-2">
                        <button 
                            onClick={() => setIsEditing(!isEditing)}
                            className={`flex items-center gap-2 px-3 py-2 rounded-lg text-white text-sm font-medium transition-colors shadow-sm ${isEditing ? 'bg-green-600 active:bg-green-700' : 'bg-blue-600 active:bg-blue-700'}`}
                        >
                            {isEditing ? <CheckIcon /> : <EditIcon />}
                            <span className="hidden sm:inline">{isEditing ? 'Done' : 'Edit'}</span>
                        </button>
                        <button 
                            onClick={handlePrint}
                            className="flex items-center gap-2 px-3 py-2 bg-gray-800 text-white rounded-lg text-sm font-medium shadow-sm active:bg-gray-900"
                        >
                            <ShareIcon />
                            <span className="hidden sm:inline">Share PDF</span>
                            <span className="sm:hidden">PDF</span>
                        </button>
                    </div>
                </div>

                {/* --- Instructions --- */}
                <div className="w-full max-w-md px-4 py-2 text-xs text-center text-gray-500 no-print mt-2">
                    {isEditing ? "Tap text to edit. Add fees using + button." : "Tap 'PDF' to save."}
                </div>

                {/* --- Scalable A4 Container --- */}
                <div 
                    id="invoice-wrapper"
                    style={{
                        width: '794px', // Fixed A4 pixel width
                        marginTop: '10px',
                        transform: `scale(${scale})`, // Dynamic scale
                        marginBottom: `-${(1 - scale) * 1123}px` // Negative margin to reduce white space caused by scaling
                    }}
                >
                    <div className="page-container bg-white shadow-xl p-[10mm] text-[10px] leading-tight text-black font-arial relative print-shadow-none" style={{ minHeight: '1123px' }}>
                        
                        {/* --- INVOICE CONTENT START --- */}

                        {/* Header Row */}
                        <div className="flex justify-between items-start mb-6">
                            {/* Left: Tax Invoice */}
                            <div className="w-1/3 pt-3">
                                <h1 className="text-xl font-extrabold uppercase tracking-wide text-black leading-none">TAX INVOICE</h1>
                            </div>

                            {/* Center: Logo */}
                            <div className="w-1/3 flex justify-center items-start -mt-3">
                                {invoiceData.logo ? (
                                    <div className="relative group text-center w-full">
                                        <img src={invoiceData.logo} alt="Company Logo" className="h-auto max-h-24 object-contain mx-auto" />
                                        {isEditing && (
                                            <button 
                                                onClick={() => setInvoiceData({...invoiceData, logo: null})}
                                                className="absolute -top-3 -right-3 bg-red-500 text-white rounded-full p-2 shadow-lg no-print"
                                            >
                                                <CloseIcon />
                                            </button>
                                        )}
                                    </div>
                                ) : (
                                    <div 
                                        onClick={() => isEditing && fileInputRef.current.click()}
                                        className={`h-20 w-40 flex flex-col items-center justify-center mx-auto mt-3 ${isEditing ? 'border-2 border-dashed border-blue-400 cursor-pointer bg-blue-50 rounded-lg' : ''}`}
                                    >
                                        {isEditing ? (
                                            <>
                                                <UploadIcon className="text-blue-500 mb-1" />
                                                <span className="text-blue-500 text-[9px] text-center font-bold">Tap to Upload Logo</span>
                                            </>
                                        ) : (
                                            <div className="flex flex-col items-center pt-1 pb-[5px]">
                                                <div className="text-2xl font-black text-blue-900 tracking-tighter leading-none">KITA</div>
                                                <div className="text-xs tracking-[0.3em] text-blue-900 leading-none">TRAVELS</div>
                                            </div>
                                        )}
                                        <input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleLogoUpload} />
                                    </div>
                                )}
                            </div>

                            {/* Right: Company Address */}
                            <div className="w-1/3 flex flex-col items-end text-right pt-3">
                                <InputField 
                                    isEditing={isEditing}
                                    value={invoiceData.companyName} 
                                    onChange={(v) => setInvoiceData({...invoiceData, companyName: v})} 
                                    className="font-bold text-[9px] uppercase text-black mb-0.5 text-right leading-none"
                                />
                                {invoiceData.companyAddress.map((line, i) => (
                                    <InputField
                                        isEditing={isEditing}
                                        key={i}
                                        value={line}
                                        onChange={(v) => updateAddress(i, v)}
                                        className="font-bold text-[9px] text-right"
                                    />
                                ))}
                            </div>
                        </div>

                        {/* Metadata Grid */}
                        <div className="flex gap-8 mb-6">
                            <div className="flex-1 space-y-2">
                                <div><div className="text-gray-500 text-[9px] mb-0.5">Booking ID</div><InputField isEditing={isEditing} value={invoiceData.bookingId} onChange={(v) => setInvoiceData({...invoiceData, bookingId: v})} className="font-bold text-xs" /></div>
                                <div><div className="text-gray-500 text-[9px] mb-0.5">Invoice No.</div><InputField isEditing={isEditing} value={invoiceData.invoiceNo} onChange={(v) => setInvoiceData({...invoiceData, invoiceNo: v})} className="font-bold text-xs" /></div>
                                <div><div className="text-gray-500 text-[9px] mb-0.5">Date</div><InputField isEditing={isEditing} value={invoiceData.date} onChange={(v) => setInvoiceData({...invoiceData, date: v})} className="font-bold text-xs" /></div>
                                <div><div className="text-gray-500 text-[9px] mb-0.5">Transactional Type/Category</div><InputField isEditing={isEditing} value={invoiceData.transType} onChange={(v) => setInvoiceData({...invoiceData, transType: v})} className="font-bold text-xs" /></div>
                                {/* Moved PAN to Left */}
                                <div><div className="text-gray-500 text-[9px] mb-0.5">PAN</div><InputField isEditing={isEditing} value={invoiceData.pan} onChange={(v) => setInvoiceData({...invoiceData, pan: v})} className="font-bold text-xs" /></div>
                            </div>

                            <div className="flex-1 space-y-2">
                                {/* Moved HSN/SAC to Top of Right Column */}
                                <div><div className="text-gray-500 text-[9px] mb-0.5">HSN/SAC</div><InputField isEditing={isEditing} value={invoiceData.hsn} onChange={(v) => setInvoiceData({...invoiceData, hsn: v})} className="font-bold text-xs" /></div>
                                <div><div className="text-gray-500 text-[9px] mb-0.5">GSTIN</div><InputField isEditing={isEditing} value={invoiceData.gstin} onChange={(v) => setInvoiceData({...invoiceData, gstin: v})} className="font-bold text-xs" /></div>
                                <div>
                                    <div className="text-gray-500 text-[9px] mb-0.5">Service Description</div>
                                    <div className="font-bold text-xs w-3/4 leading-tight">
                                        {isEditing ? <textarea className="w-full border border-blue-400 p-1 rounded bg-blue-50" rows={2} value={invoiceData.serviceDesc} onChange={(e) => setInvoiceData({...invoiceData, serviceDesc: e.target.value})} /> : invoiceData.serviceDesc}
                                    </div>
                                </div>
                                <div><div className="text-gray-500 text-[9px] mb-0.5">Tax Payable under RCM</div><InputField isEditing={isEditing} value={invoiceData.rcm} onChange={(v) => setInvoiceData({...invoiceData, rcm: v})} className="font-bold text-xs" /></div>
                            </div>
                            <div className="w-[80px]"></div>
                        </div>

                        <div className="border-t border-gray-300 my-2"></div>

                        {/* Customer Section */}
                        <div className="flex justify-between items-start py-1 mb-6">
                            {/* Left: Customer Info */}
                            <div className="w-1/2 pr-2">
                                <div className="text-gray-500 text-[9px] mb-1">Customer Name</div>
                                <InputField isEditing={isEditing} value={invoiceData.customerName} onChange={(v) => setInvoiceData({...invoiceData, customerName: v})} className="font-bold text-xs" />
                                
                                {/* Customer Address Lines */}
                                <div className="mt-1">
                                    {invoiceData.customerAddress.map((line, i) => (
                                        <InputField 
                                            key={i} 
                                            isEditing={isEditing} 
                                            value={line} 
                                            onChange={(v) => updateCustomerAddress(i, v)} 
                                            placeholder={`Address Line ${i+1}`}
                                            className="text-[9px] text-gray-700"
                                        />
                                    ))}
                                </div>
                            </div>
                            
                            {/* Right: Booked By Info */}
                            <div className="w-1/2 text-right pl-2 flex flex-col items-end">
                                <div className="text-gray-500 text-[9px] mb-1">Booked By</div>
                                <InputField isEditing={isEditing} value={invoiceData.bookedBy} onChange={(v) => setInvoiceData({...invoiceData, bookedBy: v})} className="font-bold text-xs text-right" />
                                
                                {/* Booked By Address Lines */}
                                <div className="mt-1 w-full flex flex-col items-end">
                                    {invoiceData.bookedByAddress.map((line, i) => (
                                        <InputField 
                                            key={i} 
                                            isEditing={isEditing} 
                                            value={line} 
                                            onChange={(v) => updateBookedByAddress(i, v)} 
                                            placeholder={`Address Line ${i+1}`}
                                            className="text-[9px] text-gray-700 text-right"
                                        />
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Payment Breakup */}
                        <div className="flex items-center gap-2 mb-2">
                            <div className="h-px bg-gray-400 flex-grow border-t border-dashed border-gray-400"></div>
                            <span className="text-[10px] font-bold uppercase">Payment Breakup</span>
                            <div className="h-px bg-gray-400 flex-grow border-t border-dashed border-gray-400"></div>
                        </div>

                        <div className="border border-black mb-6">
                            {/* Dynamic Rows */}
                            {invoiceData.lineItems.map((item, index) => (
                                <div key={item.id} className="flex justify-between items-start py-1.5 px-2 border-b border-gray-300 relative group">
                                    <div className="flex-grow pr-4">
                                        <div className="font-bold text-xs flex items-center">
                                            {item.description === "Fare Charges" && "*"}
                                            <InputField 
                                                isEditing={isEditing} 
                                                value={item.description} 
                                                onChange={(v) => updateLineItem(index, 'description', v)} 
                                                className="font-bold text-xs" 
                                            />
                                        </div>
                                        {(item.subtext || isEditing) && (
                                            <div className="text-[8px] text-gray-500">
                                                <InputField 
                                                    isEditing={isEditing} 
                                                    value={item.subtext} 
                                                    onChange={(v) => updateLineItem(index, 'subtext', v)} 
                                                    className="w-full"
                                                    placeholder="Subtext (optional)"
                                                />
                                            </div>
                                        )}
                                    </div>
                                    <div className="font-bold text-xs whitespace-nowrap">₹
                                        <InputField 
                                            isEditing={isEditing} 
                                            type="number" 
                                            value={item.amount} 
                                            onChange={(v) => updateLineItem(index, 'amount', v)} 
                                            className="w-16 text-right" 
                                        />
                                    </div>
                                    {isEditing && (
                                        <button 
                                            onClick={() => removeLineItem(index)}
                                            className="absolute -left-6 top-1.5 text-red-500 p-1 hover:bg-red-50 rounded no-print"
                                        >
                                            <TrashIcon />
                                        </button>
                                    )}
                                </div>
                            ))}

                            {/* Add Row Button */}
                            {isEditing && (
                                <div className="p-2 border-b border-gray-300 no-print">
                                    <button 
                                        onClick={addLineItem}
                                        className="flex items-center gap-1 text-xs text-blue-600 font-bold hover:bg-blue-50 px-2 py-1 rounded w-full justify-center"
                                    >
                                        <PlusIcon /> Add Fee
                                    </button>
                                </div>
                            )}
                            
                            {/* Total */}
                            <div className="flex justify-between items-center py-1.5 px-2 bg-gray-50 border-t border-black">
                                <div className="font-bold text-sm text-black">Grand Total</div>
                                <div className="font-bold text-sm text-black">₹{calculateTotal()}</div>
                            </div>
                        </div>

                        {/* Disclaimer */}
                        <div className="text-[9px] text-black font-bold mb-6 leading-relaxed">
                            <p>Input tax credit of GST charged by the original service provider is available only against the invoice issued by the respective service provider. {invoiceData.companyName} acts only as a facilitator for these services.</p>
                            <p className="mt-1">This is not a valid travel document</p>
                        </div>

                        {/* Terms */}
                        <div className="flex items-center gap-2 mb-2">
                            <div className="h-px bg-gray-400 flex-grow border-t border-dashed border-gray-400"></div>
                            <span className="text-[10px] font-bold uppercase">Terms & Conditions</span>
                            <div className="h-px bg-gray-400 flex-grow border-t border-dashed border-gray-400"></div>
                        </div>

                        <ol className="list-decimal pl-6 text-[9px] text-gray-500 space-y-1 mb-12">
                            <li>Any dispute with respect to the invoice is to be reported back to {invoiceData.companyName} within 48 hours of receipt of invoice.</li>
                            <li>This is system generated invoice and does not require signatures.</li>
                        </ol>

                        {/* Footer (Simplified) */}
                        <div className="absolute bottom-[10mm] left-[10mm] right-[10mm] border-t border-gray-200 pt-2 flex justify-between text-[8px] text-gray-500">
                            <div>
                                {/* Registered Office removed */}
                            </div>
                            <div className="text-right">
                                <div>{invoiceData.pageNo}</div>
                            </div>
                        </div>
                        {/* --- INVOICE CONTENT END --- */}

                    </div>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<InvoiceGenerator />);
</script>

</body>
</html>